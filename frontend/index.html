<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food & Disease Knowledge Base</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dark .glass-effect {
            background: rgba(31, 41, 55, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .nav-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .nav-button:hover:before {
            left: 100%;
        }

        .nav-button.active {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .dark .nav-button.active {
            background: rgba(255, 255, 255, 0.1);
        }

        .search-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .dark .search-input {
            background: rgba(55, 65, 81, 0.9);
            color: white;
        }

        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            background: rgba(255, 255, 255, 0.95);
        }

        .dark .search-input:focus {
            background: rgba(75, 85, 99, 0.95);
        }

        .search-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: all 0.3s ease;
        }

        .search-button:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .section-title {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .loading-spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        .dark .loading-spinner {
            border: 4px solid #4b5563;
            border-top: 4px solid #667eea;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .hidden {
            display: none;
        }

        .food-image {
            transition: all 0.3s ease;
            border-radius: 12px;
        }

        .food-image:hover {
            transform: scale(1.1);
        }

        .tag {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            display: inline-block;
            margin: 2px;
        }

        .health-status {
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.875rem;
            letter-spacing: 0.5px;
        }

        .status-healthy {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .status-error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .floating-nav {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .floating-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .floating-button:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>

<body
    class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:bg-gradient-to-br dark:from-gray-900 dark:via-gray-800 dark:to-gray-700 text-gray-800 dark:text-gray-200">
    <!-- Navigation Bar -->
    <nav class="gradient-bg shadow-2xl sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <i class="fas fa-utensils text-white text-lg"></i>
                    </div>
                    <h1 class="text-2xl font-bold text-white">Food & Health Hub</h1>
                </div>
                <div class="flex space-x-2">
                    <button id="foodsBtn" onclick="loadSection('foods')"
                        class="nav-button px-6 py-3 rounded-full text-white font-medium transition-all duration-300 hover:bg-white hover:bg-opacity-20">
                        <i class="fas fa-apple-alt mr-2"></i>Foods
                    </button>
                    <button id="distinctBtn" onclick="loadSection('distinct')"
                        class="nav-button px-6 py-3 rounded-full text-white font-medium transition-all duration-300 hover:bg-white hover:bg-opacity-20">
                        <i class="fas fa-list mr-2"></i>Categories
                    </button>
                    <button id="diseasesBtn" onclick="loadSection('diseases')"
                        class="nav-button px-6 py-3 rounded-full text-white font-medium transition-all duration-300 hover:bg-white hover:bg-opacity-20">
                        <i class="fas fa-heartbeat mr-2"></i>Health
                    </button>
                    <button id="healthBtn" onclick="loadSection('health')"
                        class="nav-button px-6 py-3 rounded-full text-white font-medium transition-all duration-300 hover:bg-white hover:bg-opacity-20">
                        <i class="fas fa-chart-line mr-2"></i>Status
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="py-16 text-center">
        <h2 class="text-5xl font-bold section-title mb-4">Discover Healthy Living</h2>
        <p class="text-xl text-gray-600 dark:text-gray-300 mb-8 max-w-2xl mx-auto">
            Explore nutritious foods, understand health relationships, and make informed dietary choices for a better
            lifestyle.
        </p>
        <!-- Enhanced Search Bar -->
        <div class="search-container px-6">
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <i class="fas fa-search text-gray-400 dark:text-gray-500"></i>
                </div>
                <select id="searchType"
                    class="absolute inset-y-0 left-10 pl-3 pr-2 py-4 text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700 border-r border-gray-300 dark:border-gray-600 rounded-l-2xl focus:outline-none">
                    <option value="foods">Foods</option>
                    <option value="diseases">Diseases</option>
                </select>
                <input id="searchInput" type="text" placeholder="Search for foods, ingredients, or diseases..."
                    class="search-input w-full pl-32 pr-4 py-4 rounded-l-2xl text-lg focus:outline-none">
                <button onclick="searchItems()"
                    class="search-button absolute right-0 top-0 h-full px-8 rounded-r-2xl text-white font-semibold">
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Stats Bar -->
    <div class="container mx-auto px-6 mb-12">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div class="glass-effect p-6 rounded-2xl text-center">
                <div class="text-3xl font-bold section-title" id="foodCount">-</div>
                <div class="text-gray-600 dark:text-gray-300 font-medium">Total Foods</div>
            </div>
            <div class="glass-effect p-6 rounded-2xl text-center">
                <div class="text-3xl font-bold section-title" id="recipeCount">-</div>
                <div class="text-gray-600 dark:text-gray-300 font-medium">Recipes</div>
            </div>
            <div class="glass-effect p-6 rounded-2xl text-center">
                <div class="text-3xl font-bold section-title" id="healthCount">-</div>
                <div class="text-gray-600 dark:text-gray-300 font-medium">Health Topics</div>
            </div>
            <div class="glass-effect p-6 rounded-2xl text-center">
                <div class="text-3xl font-bold section-title">24/7</div>
                <div class="text-gray-600 dark:text-gray-300 font-medium">Available</div>
            </div>
        </div>
    </div>

    <!-- Content Area -->
    <div class="container mx-auto px-6 pb-16">
        <!-- Loading State -->
        <div id="loading" class="text-center py-16">
            <div class="loading-spinner mb-4"></div>
            <p class="text-gray-500 dark:text-gray-400 text-lg">Loading delicious content...</p>
        </div>
        <!-- Error State -->
        <div id="error" class="text-center py-16 hidden">
            <div class="text-6xl mb-4">😔</div>
            <h3 class="text-2xl font-bold text-gray-700 dark:text-gray-200 mb-2">Oops! Something went wrong</h3>
            <p id="errorMessage" class="text-gray-500 dark:text-gray-400 text-lg"></p>
            <button onclick="location.reload()"
                class="mt-6 px-8 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-full font-semibold hover:shadow-lg transition-all duration-300">
                Try Again
            </button>
        </div>
        <!-- Content Sections -->
        <div id="foodsSection" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 hidden"></div>
        <div id="distinctSection" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 hidden"></div>
        <div id="diseasesSection" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 hidden"></div>
        <div id="healthSection" class="max-w-4xl mx-auto glass-effect p-8 rounded-3xl hidden"></div>
    </div>

    <!-- Floating Action Button -->
    <div class="floating-nav">
        <div class="floating-button" onclick="scrollToTop()">
            <i class="fas fa-chevron-up text-xl"></i>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        let currentSection = 'foods';

        function applyTheme() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }

        function showSection(sectionId) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.add('hidden');
            ['foodsSection', 'distinctSection', 'diseasesSection', 'healthSection'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            document.getElementById('errorMessage').textContent = message;
            errorDiv.classList.remove('hidden');
            document.getElementById('loading').classList.add('hidden');
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('error').classList.add('hidden');
        }

        function createFoodCard(food) {
            const card = document.createElement('div');
            card.className = 'card glass-effect p-6 rounded-3xl fade-in';
            
            // Use categories for tags display
            const categoriesHtml = food.categories && food.categories.length
                ? food.categories.map(cat => `<span class="tag">${cat}</span>`).join('')
                : (food.tags && food.tags.length ? food.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : '');
            
            const diseasesHtml = Array.isArray(food.relatedDiseases)
                ? food.relatedDiseases.map(d => typeof d === 'object' ? d.name : d).join(', ')
                : (food.relatedDiseases || '');
            
            // Fix: Safely handle recipe string truncation
            const recipeText = food.recipe ? String(food.recipe) : '';
            const truncatedRecipe = recipeText.length > 100 
                ? recipeText.substring(0, 100) + '...' 
                : recipeText;
            
            card.innerHTML = `
                <div class="relative mb-4">
                    ${food.images && food.images.length
                        ? `<img src="${food.images[0]}" alt="${food.name || 'Food'}" class="food-image w-full h-48 object-cover rounded-2xl">`
                        : `<div class="w-full h-48 bg-gradient-to-br from-orange-200 to-pink-200 dark:from-orange-800 dark:to-pink-800 rounded-2xl flex items-center justify-center">
                            <i class="fas fa-utensils text-4xl text-gray-400 dark:text-gray-500"></i>
                        </div>`
                    }
                    <div class="absolute top-4 right-4">
                        <div class="bg-white dark:bg-gray-800 bg-opacity-90 px-3 py-1 rounded-full text-sm font-semibold text-gray-700 dark:text-gray-200">
                            ${food.calories || 'N/A'} cal
                        </div>
                    </div>
                </div>
                <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200 mb-3">${food.name || 'Unknown Food'}</h3>
                <div class="space-y-3 text-sm text-gray-600 dark:text-gray-300">
                    ${food.ingredients ? `<p><i class="fas fa-list-ul w-4"></i> <strong>Ingredients:</strong> ${food.ingredients}</p>` : ''}
                    ${food.recipe ? `<p><i class="fas fa-book-open w-4"></i> <strong>Recipe:</strong> ${truncatedRecipe}</p>` : ''}
                    ${food.type ? `<p><i class="fas fa-clock w-4"></i> <strong>Best Time:</strong> ${food.type}</p>` : ''}
                    ${diseasesHtml ? `<p><i class="fas fa-heartbeat w-4"></i> <strong>Health Impact:</strong> ${diseasesHtml}</p>` : ''}
                </div>
                ${categoriesHtml ? `<div class="mt-4">${categoriesHtml}</div>` : ''}
            `;
            return card;
        }

        function createDiseaseCard(disease) {
            const card = document.createElement('div');
            card.className = 'card glass-effect p-6 rounded-3xl fade-in';
            const documentsHtml = disease.documents && disease.documents.length
                ? disease.documents.map(d => `<a href="${d}" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors" target="_blank"><i class="fas fa-external-link-alt"></i></a>`).join(' ')
                : 'N/A';
            const treatmentsHtml = disease.treatmentProtocols && disease.treatmentProtocols.length
                ? disease.treatmentProtocols.map(t => `<a href="${t}" class="text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-300 transition-colors" target="_blank"><i class="fas fa-medkit"></i></a>`).join(' ')
                : 'N/A';
            card.innerHTML = `
    <div class="mb-4">
      <div class="w-16 h-16 bg-gradient-to-br from-red-200 to-pink-200 dark:from-red-800 dark:to-pink-800 rounded-2xl flex items-center justify-center mb-4">
        <i class="fas fa-heartbeat text-2xl text-red-500 dark:text-red-400"></i>
      </div>
      <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200">${disease.name || 'Unknown Disease'}</h3>
    </div>
    <div class="space-y-3 text-sm text-gray-600 dark:text-gray-300">
      <p><i class="fas fa-symptoms w-4"></i> <strong>Symptoms:</strong> ${disease.symptoms || 'N/A'}</p>
      <p><i class="fas fa-venus-mars w-4"></i> <strong>Affects:</strong> ${disease.sex || 'N/A'}</p>
      <p><i class="fas fa-users w-4"></i> <strong>Common in:</strong> ${disease.mostCommonSubjectKind || 'N/A'}</p>
      <p><i class="fas fa-sitemap w-4"></i> <strong>Category:</strong> ${disease.familyName || 'N/A'}</p>
      <p><i class="fas fa-file-medical w-4"></i> <strong>References:</strong> ${documentsHtml}</p>
      <p><i class="fas fa-pills w-4"></i> <strong>Treatments:</strong> ${treatmentsHtml}</p>
    </div>
  `;
            return card;
        }

        async function loadFoods() {
            currentSection = 'foods';
            showSection('foodsSection');
            showLoading();
            try {
                const response = await fetch(`${API_BASE}/foods`);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                if (data.error) throw new Error(data.error);
                const section = document.getElementById('foodsSection');
                section.innerHTML = '';
                data.forEach(food => section.appendChild(createFoodCard(food)));
                document.getElementById('foodCount').textContent = data.length || '0';
                showSection('foodsSection');
            } catch (error) {
                showError(`Failed to load foods: ${error.message}`);
            }
        }

        async function loadDistinctFoods() {
            currentSection = 'distinct'; showSection('distinctSection'); showLoading(); try { const response = await fetch(`${API_BASE}/foods/distinct`); if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`); const data = await response.json(); if (data.error) throw new Error(data.error); const section = document.getElementById('distinctSection'); section.innerHTML = ''; const foods = data.data || data; foods.forEach(food => section.appendChild(createFoodCard(food))); document.getElementById('recipeCount').textContent = foods.length || '0'; showSection('distinctSection'); } catch (error) { showError(`Failed to load distinct foods: ${error.message}`); }
        }

        async function loadDiseases() {
            currentSection = 'diseases';
            showSection('diseasesSection');
            showLoading();
            try {
                const response = await fetch(`${API_BASE}/diseases`);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                if (data.error) throw new Error(data.error);
                const section = document.getElementById('diseasesSection');
                section.innerHTML = '';
                data.forEach(disease => section.appendChild(createDiseaseCard(disease)));
                document.getElementById('healthCount').textContent = data.length || '0';
                showSection('diseasesSection');
            } catch (error) {
                showError(`Failed to load diseases: ${error.message}`);
            }
        }

        async function loadHealth() {
            currentSection = 'health';
            showSection('healthSection');
            showLoading();
            try {
                const response = await fetch(`${API_BASE}/health`);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                const section = document.getElementById('healthSection');
                section.innerHTML = `
      <div class="text-center mb-8">
        <div class="w-20 h-20 bg-gradient-to-br from-green-200 to-blue-200 dark:from-green-800 dark:to-blue-800 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fas fa-chart-line text-3xl text-green-600 dark:text-green-400"></i>
        </div>
        <h2 class="text-3xl font-bold section-title mb-2">System Health Status</h2>
        <p class="text-gray-600 dark:text-gray-300">Real-time monitoring of all system components</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="text-center p-6 bg-white dark:bg-gray-800 bg-opacity-50 rounded-2xl">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Database Status</h3>
          <div class="health-status ${data.status === 'healthy' ? 'status-healthy' : 'status-error'} inline-block mb-2">
            <i class="fas fa-database mr-2"></i>${data.status || 'N/A'}
          </div>
          <p class="text-sm text-gray-600 dark:text-gray-300">Details: <strong>${data.details || 'N/A'}</strong></p>
        </div>
        <div class="text-center p-6 bg-white dark:bg-gray-800 bg-opacity-50 rounded-2xl">
          <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">API Status</h3>
          <div class="health-status ${data.status === 'healthy' ? 'status-healthy' : 'status-error'} inline-block mb-2">
            <i class="fas fa-server mr-2"></i>${data.status || 'N/A'}
          </div>
          <p class="text-sm text-gray-600 dark:text-gray-300">Details: <strong>${data.details || 'N/A'}</strong></p>
        </div>
      </div>`;
                showSection('healthSection');
            } catch (error) {
                showError(`Failed to load health status: ${error.message}`);
            }
        }

        async function searchItems() {
            const query = document.getElementById('searchInput').value.trim();
            const searchType = document.getElementById('searchType').value;
            if (!query) {
                showError('Please enter a search query');
                return;
            }
            const sectionId = searchType === 'foods' ? 'foodsSection' : 'diseasesSection';
            showSection(sectionId);
            showLoading();
            try {
                const response = await fetch(`${API_BASE}/search/${searchType}?q=${encodeURIComponent(query)}`);
                if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);
                const data = await response.json();
                if (data.error) throw new Error(data.error);
                const section = document.getElementById(sectionId);
                section.innerHTML = '';
                if (data.length === 0) {
                    section.innerHTML = `
        <div class="col-span-full text-center py-16">
          <div class="text-6xl mb-4">🔍</div>
          <h3 class="text-2xl font-bold text-gray-700 dark:text-gray-200 mb-2">No results found</h3>
          <p class="text-gray-500 dark:text-gray-400">Try searching with different keywords</p>
        </div>`;
                } else {
                    data.forEach(item => {
                        section.appendChild(searchType === 'foods' ? createFoodCard(item) : createDiseaseCard(item));
                    });
                }
                showSection(sectionId);
            } catch (error) {
                showError(`Search failed: ${error.message}`);
            }
        }

        function loadSection(section) {
            currentSection = section;
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            const buttonId = section + 'Btn';
            document.getElementById(buttonId).classList.add('active');
            if (section === 'foods') loadFoods();
            else if (section === 'distinct') loadDistinctFoods();
            else if (section === 'diseases') loadDiseases();
            else if (section === 'health') loadHealth();
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        document.getElementById('searchInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') searchItems();
        });

        window.addEventListener('load', () => {
            applyTheme();
            loadSection('foods');
        });

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyTheme);
    </script>
</body>

</html>